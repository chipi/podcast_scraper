# Cursor Rules for podcast_scraper

## üö® CRITICAL RULES (ALWAYS ENFORCE - NO EXCEPTIONS)

### Git & Branch Workflow

0. **NEVER push any branch unless the user explicitly asks**
   - Commits are allowed after user approves the diff; pushes are never allowed by default
   - Always pause and ask before any push action

1. **NEVER push directly to main branch**
   - ALWAYS create feature branch: `git checkout -b feat/name`
   - ALWAYS push to feature branch, NEVER to main

2. **NEVER commit without explicit user approval**
   - MUST: `git status` ‚Üí `git diff` ‚Üí show user ‚Üí wait for approval ‚Üí THEN commit
   - NEVER skip showing changes; NEVER assume approval

2a. **ALWAYS stage only files changed for current task (never `git add -A`)**
   - Use `git add <specific-file>` for each file you changed
   - Verify with `git status` after staging; ask user if unsure which files

3. **NEVER push to PR without explicit user approval**
   - Show `git status` + `git diff` ‚Üí wait for explicit approval
   - Pre-commit hook runs `make ci-fast` automatically

4. **ALWAYS check for uncommitted changes before creating branch**
   - Run `git status --porcelain`; if output ‚Üí commit/stash/discard first

### Terminal Command Execution

9. **üö® NEVER run commands in background ‚Äî ALWAYS `is_background: false` üö®**
   - **#1 MOST VIOLATED RULE ‚Äî PAY EXTRA ATTENTION**
   - `is_background: true` ONLY for long-running servers (e.g., `mkdocs serve`)
   - ALL `make`, `pytest`, `git`, `pip` commands MUST be foreground

9a. **NEVER use `cd` to project root before commands**
   - Terminal is ALREADY in project root; run commands directly

### Tool Usage

8a. **ALWAYS use Makefile commands, NEVER direct tool invocations**
   - ‚úÖ `make test`, `make format`, `make lint`, `make fix-md`
   - ‚ùå `pytest`, `black .`, `flake8`, `npx markdownlint-cli2`
   - Exception: `git` commands are fine; Python: `.venv/bin/python3 script.py`

8b. **ALWAYS update venv when dependency ranges change**
   - Trigger: After ANY edit to `[project.dependencies]` or `[project.optional-dependencies]` in `pyproject.toml`
   - Action: Run `pip install --upgrade -e .[dev]` BEFORE running tests or committing
   - Verify: Check that new packages are installed (or ask user to verify)

### Code Quality & Testing

13. **Write lint-valid code from the start**
    - BEFORE saving any Python file: Run `make format` on that file
    - AFTER writing a complete function/class: Check line length (< 100 chars)
    - BEFORE committing: Run `make lint` and fix all errors
    - Code must pass `make lint` before session ends

5. **ALWAYS review/update tests after code changes ‚Äî never leave failing tests**
   - Trigger: After modifying ANY code in `src/` (not just tests)
   - Action 1: Run `make ci-fast` BEFORE committing
   - Action 2: If tests fail, fix them BEFORE continuing with other work
   - Action 3: Load `testing-strategy.mdc` when writing new tests
   - Exception: If test failure is complex, document it and ask user before proceeding

12. **ALL analysis/plans ‚Üí `docs/wip/` (never `docs/analysis/` or `docs/plan/`)**
    - Applies to: Design docs, RFCs, investigation notes, planning documents, analysis outputs
    - Trigger: BEFORE creating any new doc file in `docs/`
    - Action: Save to `docs/wip/` (never `docs/analysis/` or `docs/plan/`)
    - Exception: Finalized docs can be moved out of `wip/` after review

### GitHub

14. **Use MCP GitHub server for GitHub operations**
    - Preferred: `mcp_github_*` tools; fallback: GitHub API only if MCP fails

15. **ALWAYS use correct GitHub username, NOT Mac username**
    - Use `mcp_github_get_me` to get current user's GitHub login

### Auto-Loading Detailed Rules (.mdc Files)

16. **AUTOMATICALLY load `.mdc` files when encountering specific situations**
    - These are NOT auto-loaded ‚Äî YOU must `read_file` them BEFORE proceeding
    - **ALWAYS announce loading** (e.g., "Loading testing-strategy.mdc...")
    - Load timing: BEFORE writing code/tests/docs, not after errors occur

    | Situation | Load This File | When to Load |
    |-----------|---------------|--------------|
    | Writing/modifying Python code | `coding-standards.mdc` | BEFORE writing first line |
    | Writing or modifying tests | `testing-strategy.mdc` | BEFORE writing test |
    | Running tests or validating | `testing-strategy.mdc` | BEFORE running `make test` |
    | Editing markdown or docs | `documentation.mdc` | BEFORE editing markdown |
    | Markdown linting errors | `documentation.mdc` | IMMEDIATELY when error appears |
    | Git worktree operations | `git-worktree.mdc` | BEFORE creating worktree |
    | Refactoring / module boundaries | `module-boundaries.mdc` | BEFORE moving code |
    | About to commit or push | `ai-guidelines.mdc` | BEFORE `git commit` |
    | Need decision guidance | `ai-guidelines.mdc` | When unsure about approach |

    All files in `.cursor/rules/`.

## üìã PROJECT CONTEXT

Python tool for podcast transcript downloading/generation:

- Download transcripts from RSS feeds, fallback to Whisper transcription
- Speaker detection (spaCy NER), Summarization (BART/LED or OpenAI)
- Python 3.10+, Pydantic v2, pytest, black/isort/flake8/mypy, MkDocs

### Module Boundaries (details in `module-boundaries.mdc`)

- `cli.py` ‚Üí CLI only | `service.py` ‚Üí Service API only
- `workflow.py` ‚Üí Orchestration only | `config.py` ‚Üí Config model only
- `downloader.py` ‚Üí HTTP only | `rss_parser.py` ‚Üí RSS parsing only

## üîß ESSENTIAL COMMANDS

```bash
make format        # black + isort
make lint          # flake8
make type          # mypy
make ci-fast       # Fast tests before commit (~6-10 min)
make ci            # Full CI suite (~10-15 min)
make docs          # Build docs (before committing doc changes)
make lint-markdown # Check markdown
make fix-md        # Auto-fix markdown
```

## ‚ö†Ô∏è REMEMBER

0. üö® NEVER `is_background: true` for make/test/git/pip
1. NEVER push to main (feature branches + PRs only)
2. ALWAYS show changes + get approval before commit/push
3. ALWAYS use Makefile commands, never direct tools
4. Write lint-valid code from the start
5. Respect module boundaries
6. ALWAYS `make ci-fast` before committing
7. ALL analysis/plans ‚Üí `docs/wip/`
8. Auto-load `.mdc` files for detailed guidance (Rule 16)
9. NEVER commit secrets
10. **BEFORE any commit/push OR when user says "done"/"wrap up" OR at natural task completion**:
    - Perform self-audit: review rules applied/missed, `.mdc` files loaded/should-have-loaded; note any **skills** or **subagents** used in the session
    - Append one JSON line to `.cursor/metrics/rule-adherence.jsonl` (see `.cursor/metrics/README.md` for schema). Include optional `skills_used` and `subagents_used` arrays when applicable
    - **MUST announce**: "Updated metrics file" (so user can verify)

---

**Version:** 2.0
**Updated:** 2026-02-09
**Source:** Trimmed from v1.0; details moved to `.cursor/rules/*.mdc`
