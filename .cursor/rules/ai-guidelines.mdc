# AI Coding Guidelines - Primary Reference

## ‚ö†Ô∏è MANDATORY: Read `.ai-coding-guidelines.md` First

## üö® START-OF-SESSION CHECKLIST (MANDATORY - DO THIS FIRST)

**Before taking ANY action in this project, you MUST:**

1. ‚úÖ **Read `.ai-coding-guidelines.md`** ‚Äî this is the PRIMARY source of truth
2. ‚úÖ **Acknowledge you've read it** ‚Äî say "I've read the AI guidelines" or similar
3. ‚úÖ **Confirm when asked** ‚Äî if user asks "Did you read the guidelines?", answer honestly
4. ‚úÖ **Reference it constantly** ‚Äî for all decisions about code, workflow, and patterns

**If the user asks "Did you read the guidelines?" or "Check the guidelines first":**

- ‚úÖ STOP what you're doing
- ‚úÖ Read `.ai-coding-guidelines.md` immediately
- ‚úÖ Acknowledge what you read
- ‚úÖ Then proceed with the task

## üö® CRITICAL: Git Commit Workflow - MANDATORY CHECKLIST

**YOU MUST FOLLOW THIS EXACT SEQUENCE BEFORE EVERY COMMIT:**

### Step-by-Step Commit Process (MANDATORY)

1. **Make code changes** ‚úÖ
2. **MANDATORY: Run `make ci-fast`** ‚Äî fast validation (~6-10 min)
3. **If editing markdown:** Run `make fix-md` to auto-fix common issues
4. **Self-check markdown files** (if any were edited):
   - One H1 only, blank lines after headings, no trailing spaces
   - List indentation consistent, code fences have language tags
   - Run `make lint-markdown` to verify
5. **MANDATORY: Run `git status`** ‚Äî show user what files changed
6. **MANDATORY: Run `git diff`** ‚Äî show user the actual changes
7. **MANDATORY: Wait for explicit approval** ‚Äî user must say "commit", "yes", etc.
8. **MANDATORY: Get commit message** ‚Äî user provides or you ask for one
9. **THEN commit** ‚Äî only after steps 2-8 are complete

### ‚ùå NEVER commit when

- You haven't run `make ci-fast` first
- You haven't shown `git status` first
- You haven't shown `git diff` first
- User hasn't explicitly approved
- User said "don't commit" or "wait"

## üö® CRITICAL: PR Push Workflow - MANDATORY CHECKLIST

### Step-by-Step Push Process (MANDATORY)

1. **MANDATORY: Show `git status`** ‚Äî show what will be pushed
2. **MANDATORY: Show `git diff` or change summary**
3. **Pre-commit hook has already run** ‚Äî `make ci-fast` passed during commit
4. **MANDATORY: Conditionally run `make docker-test`** ‚Äî ONLY if Docker changes
5. **MANDATORY: Ask user for explicit approval** ‚Äî wait for "push"/"yes"/"go ahead"
6. **THEN push** ‚Äî only after user has approved

### When to run `make docker-test` (CONDITIONAL)

**Run ONLY if you changed:**

- ‚úÖ Dockerfile ‚Äî any build process changes
- ‚úÖ Project structure ‚Äî package layout changes
- ‚úÖ Dependencies ‚Äî `pyproject.toml` core deps/metadata
- ‚úÖ Package configuration ‚Äî `[tool.setuptools]` changes

**Skip for:** Python-only code, docs, tests, non-Docker config.

## üö® CRITICAL: Git Branch Workflow

### NEVER Push Directly to Main

1. ‚ùå **NEVER push directly to main** ‚Äî even with admin permissions
2. ‚úÖ **ALWAYS create a feature branch**: `git checkout -b feat/name`
3. ‚úÖ **ALWAYS create a PR** for review and merge

### Branch Creation Checklist

```bash
# Step 1: Check current state
git status --porcelain
# If output exists ‚Üí commit, stash, or discard FIRST

# Step 2: Create branch from latest main
git checkout main
git pull origin main
git checkout -b feat/new-feature-name
```

## üéØ DECISION TREES

### When to Ask User

- Ambiguous requirements
- Multiple valid approaches
- Breaking changes needed
- New dependencies required
- Security implications
- Performance vs readability trade-offs

### When NOT to Ask

- Following established patterns
- Standard bug fixes
- Documentation updates
- Adding type hints (always do)
- Adding tests (always do)
- Formatting with black (always do)
- Adding docstrings (always do)

## üîç CURSOR-SPECIFIC GUIDANCE

### Model Selection

- **Auto** ‚Üí Fast iteration, small/local changes, mechanical work
- **Manual** ‚Üí Planning, debugging, architecture, complex reasoning
- Control scope: small selection ‚Üí fast model, multiple files ‚Üí stronger model
- Use reasoning language: "analyze", "root cause", "tradeoffs" ‚Üí stronger model

### Workflow Tips

- Split planning (Chat) and execution (Inline Chat)
- Use Composer for big tasks (multi-file changes)
- Reference specific sections of `.ai-coding-guidelines.md` for deep dives
- Auto-load detailed `.mdc` rules when needed (see `.cursorrules` Rule 16)

## üìã Testing Strategy Summary

```bash
# Default: Start with fast tests
make ci-fast          # Unit + fast integration + fast e2e (~6-10 min)

# If changes touch ML code, run slow tests
make test-integration-slow  # Slow integration (~5-10 min)
make test-e2e-slow         # Slow E2E (~15-20 min)
make test-all-slow         # All slow tests

# Full CI validation before PR
make ci              # Full suite (~10-15 min)
```

## üöÄ Common Commands

```bash
# Development
make install-hooks    # Install pre-commit hook (one-time)
make format           # Format code (black + isort)
make lint             # Run flake8
make type             # Run mypy
make security         # Run bandit + pip-audit

# Testing
make ci-fast          # Fast tests (~6-10 min)
make test-integration-slow  # Slow integration (~5-10 min)
make test-e2e-slow    # Slow E2E (~15-20 min)
make ci               # Full CI suite (~10-15 min)

# Documentation
make docs             # Build docs (catches broken links)
make lint-markdown    # Check markdown files
make fix-md           # Auto-fix markdown issues

# Docker (conditional)
make docker-test      # Only if changed Dockerfile/structure
```

## üìñ RELATED DOCUMENTATION

- **`.cursorrules`** ‚Äî Core project rules (always active)
- **`.ai-coding-guidelines.md`** (2,310 lines) ‚Üí Complete AI guidelines
- **`docs/guides/DEVELOPMENT_GUIDE.md`** ‚Üí Technical details (code style, testing, CI/CD)
- **`docs/guides/TESTING_GUIDE.md`** ‚Üí Test execution, fixtures, coverage
- **`docs/guides/CURSOR_AI_BEST_PRACTICES_GUIDE.md`** ‚Üí Model selection strategies
- **`docs/guides/MARKDOWN_LINTING_GUIDE.md`** ‚Üí Markdown style rules
- **`docs/guides/GIT_WORKTREE_GUIDE.md`** ‚Üí Git worktree workflow
- **`docs/ci/index.md`** ‚Üí CI/CD pipeline documentation
- **`docs/ARCHITECTURE.md`** ‚Üí System design, module responsibilities
- **`CONTRIBUTING.md`** ‚Üí Human contributor guide

**When user says "load ai coding guidelines":**

- Load `.ai-coding-guidelines.md` for complete reference
- For specific topics:
  - "load testing guide" ‚Üí `docs/guides/TESTING_GUIDE.md`
  - "load markdown guide" ‚Üí `docs/guides/MARKDOWN_LINTING_GUIDE.md`
  - "load cursor guide" ‚Üí `docs/guides/CURSOR_AI_BEST_PRACTICES_GUIDE.md`

## ‚ö†Ô∏è REMEMBER

1. NEVER push to main (use feature branches + PRs)
2. ALWAYS show changes and get approval before commit/push
3. ALWAYS run `make ci-fast` before committing
4. Write lint-valid code from the start
5. Respect module boundaries (see `module-boundaries.mdc`)
6. Mock external deps in tests
7. Use Config for all runtime options
8. NEVER commit secrets
9. ALL analysis/plans ‚Üí `docs/wip/` (never `docs/analysis/`)
10. Run `make docs` before committing doc changes

**When in doubt, check `.ai-coding-guidelines.md` or `.cursorrules`.**

---

**Version:** 3.0
**Updated:** 2026-02-09
**Source:** Expanded from v2.0 with decision trees, cursor guidance, and related docs
