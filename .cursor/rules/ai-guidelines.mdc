# AI Coding Guidelines - Primary Reference

## ‚ö†Ô∏è MANDATORY: Read .ai-coding-guidelines.md First

## üö® START-OF-SESSION CHECKLIST (MANDATORY - DO THIS FIRST)

**Before taking ANY action in this project, you MUST:**

1. ‚úÖ **Read `.ai-coding-guidelines.md`** - This is the PRIMARY source of truth
2. ‚úÖ **Acknowledge you've read it** - Say "I've read the AI guidelines" or similar
3. ‚úÖ **Confirm when asked** - If user asks "Did you read the guidelines?", answer honestly
4. ‚úÖ **Reference it constantly** - For all decisions about code, workflow, and patterns

**If the user asks "Did you read the guidelines?" or "Check the guidelines first":**
- ‚úÖ **STOP what you're doing**
- ‚úÖ **Read `.ai-coding-guidelines.md` immediately**
- ‚úÖ **Acknowledge what you read**
- ‚úÖ **Then proceed with the task**

**Before taking ANY action, you MUST:**
1. Read `.ai-coding-guidelines.md` - This is the PRIMARY source of truth
2. Follow ALL CRITICAL rules marked in that file
3. Reference it for all decisions about code, workflow, and patterns

## üö® CRITICAL: Git Commit Workflow - MANDATORY CHECKLIST

**YOU MUST FOLLOW THIS EXACT SEQUENCE BEFORE EVERY COMMIT:**

### Step-by-Step Commit Process (MANDATORY):

1. **Make code changes** ‚úÖ
2. **MANDATORY: Run `git status`** - Show user what files changed
3. **MANDATORY: Run `git diff`** - Show user the actual changes
4. **MANDATORY: Wait for explicit approval** - User must say "commit", "yes", "go ahead", etc.
5. **MANDATORY: Get commit message** - User provides message OR you ask for one
6. **THEN commit** - Only after steps 2-5 are complete

### ‚ùå NEVER commit when:
- You haven't shown `git status` first
- You haven't shown `git diff` first
- User hasn't explicitly approved
- User said "don't commit" or "wait"
- You're assuming approval from context

### ‚úÖ Example CORRECT workflow:
```
AI: I've fixed the issue. Let me show you what changed:

[Runs: git status]
[Shows: Modified: config.py]

[Runs: git diff config.py]
[Shows: actual diff]

Should I commit these changes?

User: Yes, commit with message "fix: ..."

AI: [Commits with user's message]
```

### ‚ùå Example INCORRECT workflow (DO NOT DO THIS):
```
AI: I've fixed the issue. [Commits immediately]
```

## üö® CRITICAL: PR Push Workflow - MANDATORY CHECKLIST

**YOU MUST FOLLOW THIS EXACT SEQUENCE BEFORE EVERY PUSH TO PR:**

### Step-by-Step Push Process (MANDATORY):

1. **MANDATORY: Show `git status`** - Show user what will be pushed
2. **MANDATORY: Show `git diff` or change summary** - Show user the actual changes
3. **MANDATORY: Run `make ci`** - Full CI suite locally
4. **MANDATORY: Conditionally run `make docker-test`** - Only if Docker-related changes exist (see below)
5. **MANDATORY: Verify all checks pass** - No failures allowed
6. **MANDATORY: Fix any failures** - Before pushing
7. **MANDATORY: Ask user for explicit approval** - User must say "push", "yes", "go ahead", etc.
8. **MANDATORY: Wait for user approval** - DO NOT push until user explicitly approves
9. **THEN push** - Only after steps 1-8 are complete AND user has approved

### When to run `make docker-test` (CONDITIONAL):

**Run `make docker-test` BEFORE pushing to PR ONLY if you made significant changes to:**

- ‚úÖ **Dockerfile** (`docker/Dockerfile`) - Any changes to build process, dependencies, or structure
- ‚úÖ **Project structure** - Changes to package layout, subpackages, or file organization
- ‚úÖ **Dependencies** - Changes to `pyproject.toml` that affect Docker installation
- ‚úÖ **Package configuration** - Changes to `[tool.setuptools]` in `pyproject.toml`

**When NOT to run:**
- ‚ùå Only Python code changes (no Dockerfile or structure changes)
- ‚ùå Only documentation or test file changes

### ‚ùå NEVER push to PR when:
- **User hasn't explicitly approved** (MOST IMPORTANT - CHECK THIS FIRST)
- You haven't shown `git status` first
- You haven't shown `git diff` or change summary first
- User said "don't push" or "wait"
- `make ci` hasn't been run
- `make ci` has failures
- `make docker-test` hasn't been run (when Docker-related changes exist)
- `make docker-test` has failures (when Docker-related changes exist)
- You're skipping CI checks

### ‚úÖ Example CORRECT push workflow:
```
AI: I've resolved all conflicts and fixed linting errors. Let me show you what will be pushed:

[Runs: git status]
[Shows: Modified files, new files, etc.]

[Runs: git diff --stat]
[Shows: Summary of changes]

[Runs: make ci]
[Shows: All checks passed ‚úì]

Should I push these changes to the PR?

User: Yes, go ahead

AI: [Pushes to PR]
```

### ‚ùå Example INCORRECT push workflow (DO NOT DO THIS):
```
AI: I've resolved all conflicts. [Pushes immediately without showing changes or asking]
```

## Primary Reference

**All guidelines, patterns, and rules are in `.ai-coding-guidelines.md`**
**Read it at the start of every session and reference it constantly.**

## Key Documentation Files

**When working on related tasks, read these files:**

- **`docs/guides/DEVELOPMENT_GUIDE.md`** - Detailed technical information (code style, testing, CI/CD, architecture, logging, documentation standards)
- **`docs/guides/MARKDOWN_LINTING_GUIDE.md`** - Complete markdown linting guide (automated fixing, table formatting, pre-commit hooks, CI/CD integration)
- **`docs/TESTING_STRATEGY.md`** - Comprehensive testing approach
- **`docs/ARCHITECTURE.md`** - Architecture design and module responsibilities

**These files are referenced in `.ai-coding-guidelines.md` but should be read directly when working on related tasks.**

## Markdown Files

**üö® CRITICAL: When writing or editing markdown files, ALWAYS reference:**

- **`docs/MD_STYLE.md`** - **Short markdown style contract** (concise rules for Cursor)
  - One H1 per document
  - Blank line after headings
  - Code fences always specify language
  - No trailing spaces
  - Lists have blank lines before/after
  - Tables use consistent spacing around pipes

**Before finishing any markdown file:**
1. Run `make fix-md` to auto-fix common issues
2. Self-check: (a) one H1 only, (b) blank line after headings, (c) no trailing spaces, (d) list indentation consistent, (e) code fences have language tags
3. Run `make lint-markdown` to verify

**See `docs/MD_STYLE.md` for the complete checklist and rules.**
