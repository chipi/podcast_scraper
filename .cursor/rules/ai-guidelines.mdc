# AI Coding Guidelines - Primary Reference

## âš ï¸ MANDATORY: Read `.ai-coding-guidelines.md` First

## ğŸš¨ START-OF-SESSION CHECKLIST (MANDATORY - DO THIS FIRST)

**Before taking ANY action in this project, you MUST:**

1. âœ… **Read `.ai-coding-guidelines.md`** â€” this is the PRIMARY source of truth
2. âœ… **Acknowledge you've read it** â€” say "I've read the AI guidelines" or similar
3. âœ… **Confirm when asked** â€” if user asks "Did you read the guidelines?", answer honestly
4. âœ… **Reference it constantly** â€” for all decisions about code, workflow, and patterns

**If the user asks "Did you read the guidelines?" or "Check the guidelines first":**

- âœ… STOP what you're doing
- âœ… Read `.ai-coding-guidelines.md` immediately
- âœ… Acknowledge what you read
- âœ… Then proceed with the task

## ğŸš¨ CRITICAL: Git Commit Workflow - MANDATORY CHECKLIST

**For the procedure:** Use the **commit-with-approval** skill.

**This project:** Validation = `make ci-fast` (~6â€“10 min). If markdown edited: `make fix-md`, self-check (one H1, blanks after headings, code fences with language, tables), then `make lint-markdown`. Never commit without showing `git status` and `git diff` and getting explicit approval.

## ğŸš¨ CRITICAL: PR Push Workflow - MANDATORY CHECKLIST

**For the procedure:** Use the **push-to-pr** skill.

**This project:** Show status and diff/summary; run `make docker-test` only when Docker/structure/deps changed (see list below); get explicit approval then push.

### When to run `make docker-test` (CONDITIONAL)

**Run ONLY if you changed:**

- âœ… Dockerfile â€” any build process changes
- âœ… Project structure â€” package layout changes
- âœ… Dependencies â€” `pyproject.toml` core deps/metadata
- âœ… Package configuration â€” `[tool.setuptools]` changes

**Skip for:** Python-only code, docs, tests, non-Docker config.

## ğŸš¨ CRITICAL: Git Branch Workflow

### NEVER Push Directly to Main

1. âŒ **NEVER push directly to main** â€” even with admin permissions
2. âœ… **ALWAYS create a feature branch**: `git checkout -b feat/name`
3. âœ… **ALWAYS create a PR** for review and merge

### Branch creation (this project)

Run `git status --porcelain` first; if there is output, commit, stash, or discard. Then from latest main: `git checkout main`, `git pull origin main`, `git checkout -b feat/name`.

## ğŸ¯ DECISION TREES

### When to Ask User

- Ambiguous requirements
- Multiple valid approaches
- Breaking changes needed
- New dependencies required
- Security implications
- Performance vs readability trade-offs

### When NOT to Ask

- Following established patterns
- Standard bug fixes
- Documentation updates
- Adding type hints (always do)
- Adding tests (always do)
- Formatting with black (always do)
- Adding docstrings (always do)

## ğŸ” CURSOR-SPECIFIC GUIDANCE

### Model Selection

- **Auto** â†’ Fast iteration, small/local changes, mechanical work
- **Manual** â†’ Planning, debugging, architecture, complex reasoning
- Control scope: small selection â†’ fast model, multiple files â†’ stronger model
- Use reasoning language: "analyze", "root cause", "tradeoffs" â†’ stronger model

### Workflow Tips

- Split planning (Chat) and execution (Inline Chat)
- Use Composer for big tasks (multi-file changes)
- Reference specific sections of `.ai-coding-guidelines.md` for deep dives
- Auto-load detailed `.mdc` rules when needed (see `.cursorrules` Rule 16)

## ğŸ“‹ Testing Strategy Summary

```bash
# Default: Start with fast tests
make ci-fast          # Unit + fast integration + fast e2e (~6-10 min)

# If changes touch ML code, run slow tests
make test-integration-slow  # Slow integration (~5-10 min)
make test-e2e-slow         # Slow E2E (~15-20 min)
make test-all-slow         # All slow tests

# Full CI validation before PR
make ci              # Full suite (~10-15 min)
```

## ğŸš€ Common Commands

```bash
# Development
make install-hooks    # Install pre-commit hook (one-time)
make format           # Format code (black + isort)
make lint             # Run flake8
make type             # Run mypy
make security         # Run bandit + pip-audit

# Testing
make ci-fast          # Fast tests (~6-10 min)
make test-integration-slow  # Slow integration (~5-10 min)
make test-e2e-slow    # Slow E2E (~15-20 min)
make ci               # Full CI suite (~10-15 min)

# Documentation
make docs             # Build docs (catches broken links)
make lint-markdown    # Check markdown files
make fix-md           # Auto-fix markdown issues

# Docker (conditional)
make docker-test      # Only if changed Dockerfile/structure
```

## ğŸ“– RELATED DOCUMENTATION

- **`.cursorrules`** â€” Core project rules (always active)
- **`.ai-coding-guidelines.md`** (2,310 lines) â†’ Complete AI guidelines
- **`docs/guides/DEVELOPMENT_GUIDE.md`** â†’ Technical details (code style, testing, CI/CD)
- **`docs/guides/TESTING_GUIDE.md`** â†’ Test execution, fixtures, coverage
- **`docs/guides/CURSOR_AI_BEST_PRACTICES_GUIDE.md`** â†’ Model selection strategies
- **`docs/guides/MARKDOWN_LINTING_GUIDE.md`** â†’ Markdown style rules
- **`docs/guides/GIT_WORKTREE_GUIDE.md`** â†’ Git worktree workflow
- **`docs/ci/index.md`** â†’ CI/CD pipeline documentation
- **`docs/ARCHITECTURE.md`** â†’ System design, module responsibilities
- **`CONTRIBUTING.md`** â†’ Human contributor guide

**When user says "load ai coding guidelines":**

- Load `.ai-coding-guidelines.md` for complete reference
- For specific topics:
  - "load testing guide" â†’ `docs/guides/TESTING_GUIDE.md`
  - "load markdown guide" â†’ `docs/guides/MARKDOWN_LINTING_GUIDE.md`
  - "load cursor guide" â†’ `docs/guides/CURSOR_AI_BEST_PRACTICES_GUIDE.md`

## âš ï¸ REMEMBER

1. NEVER push to main (use feature branches + PRs)
2. ALWAYS show changes and get approval before commit/push
3. ALWAYS run `make ci-fast` before committing
4. Write lint-valid code from the start
5. Respect module boundaries (see `module-boundaries.mdc`)
6. Mock external deps in tests
7. Use Config for all runtime options
8. NEVER commit secrets
9. ALL analysis/plans â†’ `docs/wip/` (never `docs/analysis/`)
10. Run `make docs` before committing doc changes

**When in doubt, check `.ai-coding-guidelines.md` or `.cursorrules`.**

---

**Version:** 3.0
**Updated:** 2026-02-09
**Source:** Expanded from v2.0 with decision trees, cursor guidance, and related docs
